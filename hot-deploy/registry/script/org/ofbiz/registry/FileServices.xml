<?xml version="1.0" encoding="UTF-8"?>
<!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor
	license agreements. See the NOTICE file distributed with this work for additional
	information regarding copyright ownership. The ASF licenses this file to
	you under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of
	the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required
	by applicable law or agreed to in writing, software distributed under the
	License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS
	OF ANY KIND, either express or implied. See the License for the specific
	language governing permissions and limitations under the License. -->

<simple-methods xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/simple-methods-v2.xsd">

	<!-- file types-->



	<simple-method method-name="createfiletype"
		short-description="Create File Type">
		<make-value entity-name="RegistryFileType" value-field="newEntity" />
		<set-pk-fields map="parameters" value-field="newEntity" />
		<set-nonpk-fields map="parameters" value-field="newEntity" />
		<sequenced-id sequence-name="RegistryFileType" field="fileTypeId" />

		<set from-field="fileTypeId" field="newEntity.fileTypeId" />
		<create-value value-field="newEntity" />
	</simple-method>


	<simple-method method-name="updatefileType"
		short-description="Update an existing Budget">
		<entity-one entity-name="RegistryFileType" value-field="lookedUpValue" />
		<set-nonpk-fields map="parameters" value-field="lookedUpValue" />
		<set-pk-fields value-field="lookedUpValue" map="parameters" />
		<store-value value-field="lookedUpValue" />

	</simple-method>

	<simple-method method-name="deletefileType"
		short-description="Remove an file type">
		<set field="fileTypeId" from-field="parameters.fileTypeId" />
		<entity-one entity-name="RegistryFileType" value-field="lookedUpValue" />
		<remove-value value-field="lookedUpValue" />
	</simple-method>

<!-- files -->
	<simple-method method-name="creatememberFiles"
		short-description="Create File Book">
		<now-timestamp field="nowTimestamp"/>
		<make-value entity-name="RegistryFiles" value-field="newEntity" />
		<set-pk-fields map="parameters" value-field="newEntity" />
		<set-nonpk-fields map="parameters" value-field="newEntity" />
		<sequenced-id sequence-name="RegistryFiles" field="fileId" />
		<set from-field="fileId" field="newEntity.fileId" />

		<entity-one value-field="member" entity-name="Member">
			<field-map field-name="partyId" value="${newEntity.partyId}"/>
		</entity-one>

		<set value="FNO-${newEntity.fileId}-${member.firstName}" field="newEntity.folioNo" />
		<set value="REGISTRY" field="newEntity.fileLocation" />
		<set value="AVAILABLE" field="newEntity.status" />
		<set value="${userLogin.partyId}" field="newEntity.creator" />
		<set from-field="nowTimestamp" field="newEntity.creationDate"/>
		<create-value value-field="newEntity" />
	</simple-method>

	<simple-method method-name="updateFiles"
		short-description="Update an existing Budget">
		<entity-one entity-name="RegistryFiles" value-field="lookedUpValue" />
		<set-nonpk-fields map="parameters" value-field="lookedUpValue" />
		<set-pk-fields value-field="lookedUpValue" map="parameters" />
		<store-value value-field="lookedUpValue" />

	</simple-method>



	<simple-method method-name="requestfiles"
		short-description="request File ">
		<make-value entity-name="RegistryFilesRequest" value-field="newEntity" />
		<set-pk-fields map="parameters" value-field="newEntity" />
		<set-nonpk-fields map="parameters" value-field="newEntity" />
		<sequenced-id sequence-name="RegistryFilesRequest" field="requestId" />
		<set from-field="requestId" field="newEntity.requestId" />
		<create-value value-field="newEntity" />

		<!-- Java Method to update Entity File -->
<!--         <call-class-method class-name="org.ofbiz.registry.FileServices" method-name="updateFileStatus" >
            <field field="newEntity" type="GenericValue"/>
            <field field="delegator" type="org.ofbiz.entity.Delegator"/>
        </call-class-method> -->


		<entity-one value-field="file" entity-name="RegistryFiles">
			<field-map field-name="fileId" value="${newEntity.fileId}"/>
		</entity-one>

<!-- 
		<set field="updateFileStatusMap.fileId" value="${newEntity.fileId}" />
		<set field="updateFileStatusMap.status" value="REQUESTED" /> -->
		<!-- <set field="updateFileStatusMap.partyId" value="10010" /> -->


		<call-service service-name="updateFileStatus" in-map-name="updateFileStatusMap" />

	</simple-method>

	<simple-method method-name="updateFileStatus" short-description="Update a file's status">
        <make-value value-field="lookupPKMap" entity-name="RegistryFiles"/>
        <set-pk-fields map="parameters" value-field="lookupPKMap"/>
        <find-by-primary-key map="lookupPKMap" value-field="lookedUpValue"/>
        <set-nonpk-fields map="parameters" value-field="lookedUpValue"/>
        <store-value value-field="lookedUpValue"/>
    </simple-method>

	<simple-method method-name="issuefiles"
		short-description="issue File ">
		<make-value entity-name="FileIssue" value-field="newEntity" />
		<set-pk-fields map="parameters" value-field="newEntity" />
		<set-nonpk-fields map="parameters" value-field="newEntity" />
		<sequenced-id sequence-name="FileIssue" field="fileIssueId" />
		<set from-field="fileIssueId" field="newEntity.fileIssueId" />

		<set value="${fl.fileIssueId}" field="newEntity.fileIssueId" />
		<create-value value-field="newEntity" />
	</simple-method>

	<simple-method method-name="releasefiles"
		short-description="release File ">
		<make-value entity-name="RegistryFileRelease" value-field="newEntity" />
		<set-pk-fields map="parameters" value-field="newEntity" />
		<set-nonpk-fields map="parameters" value-field="newEntity" />
		<sequenced-id sequence-name="RegistryFileRelease" field="releaseId" />
		<set from-field="releaseId" field="newEntity.releaseId" />
		<create-value value-field="newEntity" />
	</simple-method>

	<!-- documents -->
	<simple-method method-name="createDocument"
		short-description="Create File ">
		<make-value entity-name="RegistryDocuments" value-field="newEntity" />
		<set-pk-fields map="parameters" value-field="newEntity" />
		<set-nonpk-fields map="parameters" value-field="newEntity" />
		<sequenced-id sequence-name="RegistryDocuments" field="documentId" />
		<set from-field="documentId" field="newEntity.documentId" />
		<create-value value-field="newEntity" />
	</simple-method>

<!-- locations -->
	<simple-method method-name="createfilelocation"
		short-description="Create File location">
		<make-value entity-name="RegistryFileLocations" value-field="newEntity" />
		<set-pk-fields map="parameters" value-field="newEntity" />
		<set-nonpk-fields map="parameters" value-field="newEntity" />
		<sequenced-id sequence-name="RegistryFileLocations" field="locationId" />

		<set from-field="locationId" field="newEntity.locationId" />
		<create-value value-field="newEntity" />
	</simple-method>

	<simple-method method-name="updatefilelocation"
		short-description="Update an existing Budget">
		<entity-one entity-name="RegistryFileLocations" value-field="lookedUpValue" />
		<set-nonpk-fields map="parameters" value-field="lookedUpValue" />
		<set-pk-fields value-field="lookedUpValue" map="parameters" />
		<store-value value-field="lookedUpValue" />

	</simple-method>

	<simple-method method-name="deletefilelocation"
		short-description="Remove an file type">
		<set field="locationId" from-field="parameters.locationId" />
		<entity-one entity-name="RegistryFileLocations" value-field="lookedUpValue" />
		<remove-value value-field="lookedUpValue" />
	</simple-method>






</simple-methods>
