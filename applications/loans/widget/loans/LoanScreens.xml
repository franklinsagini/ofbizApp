<?xml version="1.0" encoding="UTF-8"?>
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">
    <!-- AccountProduct -->
    <screen name="AccountProduct">
        <section>
            <actions>
                <set field="titleProperty" value="New Account"/>
                <set field="headerItem" value="AccountProduct"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createAccountProduct"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/>
                <set field="accountProductId" from-field="parameters.accountProductId"/>
                
                <entity-one entity-name="AccountProduct" value-field="accountContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="New Account">
                                    <include-form name="AccountProduct" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                                
                                
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                            
                        </section>
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Products List">
                        			<include-form name="listAccountProduct" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- LoanProduct -->
    <screen name="LoanProduct">
        <section>
            <actions>
                <set field="titleProperty" value="New Loan Product"/>
                <set field="headerItem" value="LoanProduct"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createLoanProduct"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/>
                <set field="loanProductId" from-field="parameters.loanProductId"/>
                
                <entity-one entity-name="LoanProduct" value-field="loanContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="New Loan Product">
                                    <include-form name="LoanProduct" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Products List">
                        			<include-form name="listLoanProduct" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <!-- Loan Security -->
     <screen name="NewLoanSecurity">
        <section>
            <actions>
                <set field="titleProperty" value="Create New Loan Security"/>
                <set field="headerItem" value="loansecurity"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createLoanSecurity"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!-- property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
                <set field="loanSecurityId" from-field="parameters.loanSecurityId"/>
                
                <entity-one entity-name="LoanSecurity" value-field="loanSecurityContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="New Loan Security">
                                    <include-form name="NewLoanSecurity" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Security List">
                        			<include-form name="listLoanSecurity" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- Loan Status -->
     <screen name="NewLoanStatus">
        <section>
            <actions>
                <set field="titleProperty" value="Create New Loan Status"/>
                <set field="headerItem" value="loanstatus"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createLoanStatus"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!--  property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
                <set field="name" from-field="parameters.name"/>
                
                <entity-one entity-name="LoanStatus" value-field="loanStatusContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="New Loan Status">
                                    <include-form name="NewLoanStatus" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Loan Status List">
                        			<include-form name="listLoanStatus" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- Loan Application Listing -->
    <screen name="loanapplicationslist">
        <section>
            <actions>
                <set field="titleProperty" value="List Loan Applications"/>
                <set field="headerItem" value="loanapplicationslist"/>
                <set field="tabButtonItem" value="findparty"/>
                <set field="partyListSize" value="20"/>
                <set field="loanApplicationCtx" from-field="parameters"/>

                <!-- service service-name="listLoanApplications" auto-field-map="parameters"/ -->
                
                <!-- entity-condition entity-name="LoanApplication" list="applicationsList">
                	<limit-range size="20" start="1"/>
                	
            </entity-condition -->
            
            <!-- limit-view view-size="20" view-index=""/ -->
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <!-- do check for PARTYMGR, _VIEW permission -->
                            <!-- condition>
                                <if-service-permission service-name="partyBasePermissionCheck" main-action="VIEW"/>
                            </condition -->
                            <widgets>
                                <!-- platform-specific>
                                    <html><html-template location="component://loans/webapp/loans/application/listloanapplications.ftl"/></html>
                                </platform-specific -->
                                <screenlet>
                                	<include-form name="FindLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                                
                                <screenlet>
                                	<include-form name="listLoanApplications" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3" text="${uiLabelMap.PartyMgrViewPermissionError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>	
    
    <!-- Loan Application Details -->
    <screen name="viewapplicationprofile">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleViewPartyProfile"/>
                <set field="tabButtonItem" value="viewprofile"/>
                <set field="headerItem" value="loanapplicationslist"/>
                <set field="labelTitleProperty" value="PartyTaxAuthInfos"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                
                <entity-one entity-name="LoanApplication" value-field="loanApplication">
                                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                </entity-one>
                
                 
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                       
                        <section>
                            <condition>
                                <not><if-empty field="loanApplication"/></not>
                            </condition>
                            <widgets>
                                <!-- section>
                                    <condition>
                                        <if-compare field="showOld" operator="equals" value="true" type="Boolean"/>
                                    </condition>
                                    <widgets>
                                        <container style="button-bar button-style-2">
                                            <link target="viewmemberprofile" text="${uiLabelMap.PartyHideOld}">
                                                <parameter param-name="partyId" from-field="party.partyId"/>
                                            </link>
                                        </container>
                                    </widgets>
                                    <fail-widgets>
                                        <container style="button-bar button-style-2">
                                            <link target="viewmemberprofile" text="${uiLabelMap.PartyShowOld}">
                                                <parameter param-name="partyId" from-field="party.partyId"/>
                                                <parameter param-name="SHOW_OLD" value="true"/>
                                            </link>
                                        </container>
                                    </fail-widgets>
                                </section -->
                               
                                        <!-- include-portal-page id="PartyProfile"/ -->
                                        
                                   		<include-portal-page id="ApplicationProfile"/>
                               
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- LoanApplication -->
    <screen name="LoanApplication">
        <section>
            <actions>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="parameters.loanApplicationId" from-field="parameters.loanApplicationId"/>
                <entity-and entity-name="PartyNameHistory" list="partyNameHistoryList">
                    <field-map field-name="partyId" from-field="parameters.partyId"/>
                    <order-by field-name="-changeDate"/>
                </entity-and>
                <entity-one entity-name="PartyAndGroup" value-field="lookupGroup">
                    <field-map field-name="partyId" from-field="parameters.partyId"/><!-- is required -->
                </entity-one>
                <entity-one entity-name="LoanApplication" value-field="lookupLoanApplication">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/><!-- is required -->
                </entity-one >
                
                <entity-one value-field="lookupLoanStatus" entity-name="LoanStatus">
                	<field-map field-name="name" value="${loanApplication.applicationStatus}"/>
                </entity-one>
                
                <!-- entity-one entity-name="SaccoProduct" value-field="lookupLoanType">
                    <field-map field-name="saccoProductId" from-field="lookupLoanApplication.saccoProductId"/>
                </entity-one -->
                <entity-one entity-name="LoanProduct" value-field="lookupLoanType">
                    <field-map field-name="loanProductId" from-field="lookupLoanApplication.loanProductId"/><!-- is required -->
                </entity-one>
                
                <entity-one entity-name="PaymentMethodType" value-field="lookupPaymentMethodType">
                    <field-map field-name="paymentMethodTypeId" from-field="lookupLoanApplication.paymentMethodTypeId"/><!-- is required -->
                </entity-one>
                
                
                 <entity-one entity-name="LoanStatus" value-field="lookupLoanStatus">
                    <field-map field-name="name" from-field="lookupLoanApplication.name"/><!-- is required -->
                </entity-one>
                
                <entity-and entity-name="LoanApplicationSecurity" list="loanApplicationSecurityList">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                    <!--  order-by field-name="-changeDate"/ -->
                </entity-and>
                
                 <entity-and entity-name="LoanApplicationCallateral" list="loanApplicationCallateralList">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                    <!--  order-by field-name="-changeDate"/ -->
                    
                </entity-and>
                
                 <entity-and entity-name="LoanGuarantor" list="loanGuarantorsList">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                    <!--  order-by field-name="-changeDate"/ -->
                </entity-and>
                
                
                
                <entity-and list="partyContentList" entity-name="PartyContent">
                    <field-map field-name="partyId" from-field="parameters.partyId"/>
                    <field-map field-name="partyContentTypeId" value="LGOIMGURL"/>
                    <order-by field-name="-fromDate"/>
                </entity-and>
                <set field="partyContentId" from-field="partyContentList[0].contentId"/>
                <set field="partyContent" value="${groovy: partyContentId!=null?&quot;/content/control/stream?contentId=&quot; + partyContentId : &quot;&quot;}"/>
                <set field="partyGroupLogoLinkUrl" from-field="partyContent" default-value="${lookupGroup.logoImageUrl}" global="true"/>
                <set field="personalImage" from-field="partyContent"/>
                
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <set field="collateralsAvailable" value="${bsh:org.ofbiz.loans.LoanServices.loanHasCollateral(loanApplicationId);}" type="String"   />
				<set field="guarantorsAvailable" value="${bsh:org.ofbiz.loans.LoanServices.loanHasGuarantors(loanApplicationId);}" type="String"   />
				<set field="guarantorsTotalDepositsEnough" value="${bsh:org.ofbiz.loans.LoanServices.guarantorTotalsEqualLoanTotal(loanApplicationId);}" type="String"   />
				<!-- set field="eacherGuarantorGreaterThanAverage" value="${bsh:org.ofbiz.loans.LoanServices.checkEachGuarantorDepositGreaterThanAverage(loanApplicationId);}" type="String"   /-->
                
            </actions>
            <widgets>
                <section>
                    <condition>
                        <not><if-empty field="lookupLoanApplication"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <or>
                                    <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                                    <if-compare-field field="parameters.partyId" operator="equals" to-field="userLogin.partyId"/>
                                </or>
                            </condition -->
                            <widgets>
                            	<!-- section>
									<condition>
										<and>
											<if-compare operator="equals" value="N" field="collateralsAvailable"/>
											<if-compare operator="equals" value="N" field="guarantorsAvailable"/>
										</and>
										
									</condition>
									<widgets>
										<container>
									
												<label  style="h3"> Loan Application must have Collateral or Guarantors - Please Add</label>
										</container>
									</widgets>
								</section -->
								
								<section>
									<condition>
										<and>
											<if-compare operator="equals" value="N" field="collateralsAvailable"/>
											<if-compare operator="equals" value="N" field="guarantorsAvailable"/>
										</and>
									</condition>
									<widgets>
										<container>
									
												<label style="h3"> Please provide Guarantors or Collateral</label>
										</container>
									</widgets>
								</section>
								
								<section>
									<condition>
										<if-compare operator="equals" value="N" field="guarantorsTotalDepositsEnough"/>
									</condition>
									<widgets>
										<container>
									
												<label style="h3"> Guarantors total deposit is not enough (Sum of Guarantor deposits must be more or equal to the loan amount)</label>
										</container>
									</widgets>
								</section>
								
								
								<!-- section>
									<condition>
										<if-compare operator="equals" value="N" field="eacherGuarantorGreaterThanAverage"/>
									</condition>
									<widgets>
										<container>
									
												<label style="h3"> Each Guarantor must have enough deposit for his/her share of the loan guaranteed </label>
										</container>
									</widgets>
								</section -->
                            
                                <screenlet title="Loan Information" navigation-menu-name="personUpdate" id="PartyPersonalInformationPanel">
                                           <!-- include-menu name="personUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/ -->
                                    <!-- include-form name="ViewPartyPerson" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                    <include-form name="ViewLoanApplicationDetails" location="component://loans/widget/loans/LoanForms.xml"/>
                                    <section>
                                        <!--  condition -->
                                            <!--  not><if-empty field="partyNameHistoryList"/></not -->
                                            
                                            <!-- not><if-empty field="loanApplicationSecurityList"/></not -->
                                        <!-- /condition -->
                                        <widgets>
                                            <!-- include-form name="ViewPartyPersonHistory" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                            <screenlet title="Add Loan Security">
                                            	<include-form name="NewLoanApplicationSecurity" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Loan Security List">
                                            	<include-form name="ViewLoanSecurityList" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                             <screenlet title="Add Collateral">
                                            	<include-form name="NewCollateral" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Collateral List">
                                            	<include-form name="ViewLoanCollateralList" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                             <screenlet title="Add Guarantor">
                                            	<include-form name="NewGuarantor" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Guarantors List">
                                            	<include-form name="ViewLoanGuarantorsList" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                             <screenlet title="Add Charge">
                                            	<include-form name="NewLoanApplicationCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Charges List">
                                            	<include-form name="listLoanApplicationCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                            </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <screenlet title="${uiLabelMap.PartyPersonalInformation}" id="PartyPersonalInformationPanel">
                                    <include-form name="ViewPartyPerson" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyPersonHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </widgets>
                </section>
                <section>
                    <condition>
                        <not><if-empty field="lookupGroup"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                               </condition -->
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyPartyGroupInformation}" navigation-menu-name="groupUpdate" id="PartyGroupInformationPanel">
                                    <include-menu name="groupUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/>
                                    <include-form name="ViewPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyGroupHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <screenlet title="${uiLabelMap.PartyPartyGroupInformation}" id="PartyGroupInformationPanel">
                                    <include-form name="ViewPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyGroupHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </widgets>
                </section>
            </widgets>
        </section>
    </screen>
    
    <!-- 
    	reviewLoan
    	appraiseLoan
    	approveLoan
    	disburseLoan
     -->
     <!-- reviewLoan -->
     <screen name="reviewLoan">
        <section>
            <actions>
                <set field="titleProperty" value="Review Loan"/>
                <set field="headerItem" value="reviewLoan"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createReviewLoan"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!--  property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanStatusLog" value-field="loanStatusLogContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="Review Loan">
                                    <include-form name="reviewLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Review Log">
                        			<include-form name="listReviewLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
     
     <!-- appraiseLoan -->
     <screen name="appraiseLoan">
        <section>
            <actions>
                <set field="titleProperty" value="Appraise Loan"/>
                <set field="headerItem" value="appraiseLoan"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createAppraiseLoan"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!--  property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
               <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanStatusLog" value-field="loanStatusLogContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="Appraise Loan">
                                    <include-form name="appraiseLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Appraisal Log">
                        			<include-form name="listAppraiseLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
     <!-- approveLoan -->
     <screen name="approveLoan">
        <section>
            <actions>
                <set field="titleProperty" value="Approve Loan"/>
                <set field="headerItem" value="approveLoan"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createApproveLoan"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!--  property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanStatusLog" value-field="loanStatusLogContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="Approve Loan">
                                    <include-form name="approveLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Approve Log">
                        			<include-form name="listApproveLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
     <!-- disburseLoan -->
     <screen name="disburseLoan">
        <section>
            <actions>
                <set field="titleProperty" value="Disburse Loan"/>
                <set field="headerItem" value="disburseLoan"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createDisburseLoan"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!--  property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
               <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
               <entity-one value-field="loanApplication" entity-name="LoanApplication">
               		<field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
               </entity-one>
               
               <set field="loanProductId" value="${loanApplication.loanProductId}"/>
               <entity-one value-field="loanProduct" entity-name="LoanProduct">
               		<field-map field-name="loanProductId"  value="${loanApplication.loanProductId}"/>
               </entity-one>
                
                <entity-one entity-name="LoanStatusLog" value-field="loanStatusLogContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                            	<screenlet>
                                	<section>
                                		<widgets>
                                			<container>
                                				<label style="h3">Member    : ${loanApplication.firstName} ${loanApplication.lastName}</label>
                                				<label style="h3">Product(Loan Type) : ${loanProduct.name} -  ${loanProduct.code}</label>
                                				<label style="h3">Amount    : KES ${loanApplication.loanAmt}</label>
                                				<label style="h3">Interest(P.M.)  : ${loanApplication.interestRatePM}</label>
                                				<label style="h3">Repayment(Months) : ${loanApplication.repaymentPeriod}</label>
                                				<label style="h3">Deduction Method : ${loanProduct.deductionType}</label>
                                				<label style="h3">Per Month Repayment : KES ${loanApplication.monthlyRepayment}</label>
                                				<label style="h3">Total Repayment : KES ${loanApplication.totalRepayment}</label>
                                            
                                            </container>
                                		</widgets>
                                	</section>
                                </screenlet>
                                <screenlet title="Charges">
                        			<include-form name="listDisbursementLoanApplicationCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                                <screenlet title="Disburse Loan">
                                    <include-form name="disburseLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                                <screenlet>
                                	<section>
                                		<condition>
                                			<if-compare operator="equals" value="Y" field="loanApplication.isDisbursed"/>
                                		</condition>
                                		<widgets>
                                			
                                			<container style="button-bar">
                                		
                                            <link target="generateschedule?loanApplicationId=${loanApplicationId}"  text="Generate Schedule" style="buttontext create">
                                                <image url-mode="raw" src="${iconsLocation}/add.png"/>
                                                
                                            </link>
                                            
                                            <link target="amortizationSchedulePdf.pdf" text="Print Schedule PDF" style="buttontext">
                                                <parameter param-name="loanApplicationId"/>
                                                <image url-mode="raw" src="${iconsLocation}/page_white_acrobat.png"/>
                                            </link>
                                            
                                            <link target="amortizationschedulecsv.csv" text="Generate Schedule CSV" style="buttontext">
                                                <parameter param-name="loanApplicationId"/>
                                                <!-- image url-mode="raw" src="${iconsLocation}/page_white_acrobat.png"/ -->
                                                <image url-mode="raw" src="${iconsLocation}/page_excel.png"/>
                                            </link>
                                            </container>
                                		</widgets>
                                		<fail-widgets>
                                			<container style="button-bar">
                                				<label style="h3"> Waiting for Disbursement to Generate Schedule</label>
                                			</container>
                                		</fail-widgets>
                                	</section>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Disburse Log">
                        			<include-form name="listDisburseLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                        
                        <section name="Amortization">
                        	<widgets>
                        		<screenlet title="Amortization Schedule">
                        			<include-form name="listAmortizationSchedule" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    
     <screen name="amortizationschedulecsv">
        <section>
            <actions>
                
               <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
               <entity-one value-field="loanApplication" entity-name="LoanApplication">
               		<field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
               </entity-one>
               
               <set field="loanProductId" value="${loanApplication.loanProductId}"/>
               <entity-one value-field="loanProduct" entity-name="LoanProduct">
               		<field-map field-name="loanProductId"  value="${loanApplication.loanProductId}"/>
               </entity-one>
                <set field="viewSize" value="100000"/>
            </actions>
            <widgets>
            
                <!-- decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body" -->
                      
                        <section name="Amortization">
                        	<widgets>
                        		<screenlet title="Amortization Schedule">
                        			<include-form name="listAmortizationSchedule" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    <!-- /decorator-section>
                </decorator-screen -->
            </widgets>
        </section>
    </screen>
    
    <!-- FindLoanApplication -->
    <screen name="FindLoanApplication">
        <section>
            <actions>
                <!-- set field="headerItem" value="ExampleMenuItem"/>
                <set field="titleProperty" value="PageTitleFindExample"/ -->
                <set field="headerItem" value="FindLoanApplication"/>
                <set field="titleProperty" value="Find Loan Application"/>
                <set field="loanApplicationCtx" from-field="parameters"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                        <container style="button-bar">
                                        
                                        <!-- link target="EditExampleLayer" link-type="ajax-window" height="500" width="500" text="${uiLabelMap.ExampleNewExample}" style="buttontext create"/ -->
                                        <link target="loanapplication" text="New Loan Application" style="buttontext create"></link>
                                        <link target="salaryProcessingDate" text="Set Salary Processing Date" style="buttontext create"></link>
                                        
                                        </container>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindLoanApplications" location="component://loans/widget/loans/ExampleForms.xml"/>
                                    
                                    	<screenlet name="Print Report">
                                    		<container style="button-bar">
                                		
                                            <link target="loanslistpdf.pdf" text="Print Loans PDF" style="buttontext">
                                                <parameter param-name="loanApplicationId"/>
                                                <image url-mode="raw" src="${iconsLocation}/page_white_acrobat.png"/>
                                            </link>
                                            
                                            <link target="loanslistcsv.csv" text="Loans CSV" style="buttontext">
                                                <parameter param-name="loanApplicationId"/>
                                                <!-- image url-mode="raw" src="${iconsLocation}/page_white_acrobat.png"/ -->
                                                <image url-mode="raw" src="${iconsLocation}/page_excel.png"/>
                                            </link>
                                            </container>
                                    	</screenlet>
                                    </decorator-section>
                                   
                                    
                                    
                                    <decorator-section name="search-results">
                                        <include-form name="findListLoanApplications" location="component://loans/widget/loans/ExampleForms.xml"/>
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.ExampleViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- FindLoanApplicationCSV -->
    <screen name="loanslistcsv">
        <section>
            <actions>
                <!-- set field="headerItem" value="ExampleMenuItem"/>
                <set field="titleProperty" value="PageTitleFindExample"/ -->
                <set field="headerItem" value="FindLoanApplication"/>
                <set field="titleProperty" value="Find Loan Application"/>
                <set field="loanApplicationCtx" from-field="parameters"/>
            </actions>
            <widgets>
                
                                   <screenlet>
                                   	 <include-form name="findListLoanApplicationsTrimed" location="component://loans/widget/loans/ExampleForms.xml"/>
                                   </screenlet>
                                       
                    
                            
            </widgets>
        </section>
    </screen>
    
    <screen name="loanslistpdf">
        <section>
            <actions>
                <!-- set field="headerItem" value="ExampleMenuItem"/>
                <set field="titleProperty" value="PageTitleFindExample"/ -->
                <set field="headerItem" value="FindLoanApplication"/>
                <set field="titleProperty" value="Find Loan Application"/>
                <set field="loanApplicationCtx" from-field="parameters"/>
            </actions>
            <widgets>
            <decorator-screen name="FoReportDecorator" location="component://common/widget/CommonScreens.xml">
					<!-- decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}" -->
					<decorator-section name="body">
                
                                   <screenlet>
                                   	 <include-form name="findListLoanApplicationsTrimed" location="component://loans/widget/loans/ExampleForms.xml"/>
                                   </screenlet>
                                       
                    </decorator-section>
                    </decorator-screen>
                            
            </widgets>
        </section>
    </screen>
    
    <!-- Lookup Member -->
    <screen name="LookupMember">
        <section>
            <!-- condition>
                <if-service-permission service-name="catalogPermissionCheck" main-action="VIEW"/>
            </condition -->
            <actions>
                <!-- property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/ -->
                <set field="title" value="Members Search"/>
                <set field="queryString" from-field="result.queryString"/>
                <set field="entityName" value="Member"/>
                <set field="searchFields" value="[partyId, firstName, lastName]"/>
                 <set field="displayFields" value="[firstName, lastName, idNumber]"/>
            </actions>
            <widgets>
                <decorator-screen name="LookupDecorator" location="component://common/widget/CommonScreens.xml">
                    <decorator-section name="search-options">
                        <include-form name="lookupMember" location="component://loans/widget/loans/LoanForms.xml"/>
                    </decorator-section>
                    <decorator-section name="search-results">
                        <include-form name="listLookupMember" location="component://loans/widget/loans/LoanForms.xml"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- Salary Processing Date -->
    <screen name="NewSalaryProcessingDate">
        <section>
            <actions>
                <set field="titleProperty" value="Set Salary Processing Date"/>
                <set field="headerItem" value="salaryProcessingDate"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createSalaryProcessingDate"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!-- property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
                <set field="salaryProcessingDateId" from-field="parameters.salaryProcessingDateId"/>
                
                <entity-one entity-name="SalaryProcessingDate" value-field="salaryProcessingDateContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="Set Salary Processing Date">
                                    <include-form name="NewSalaryProcessingDate" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Salary Processing Date">
                        			<include-form name="listSalaryProcessingDate" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- LoanProductCharge -->
    <screen name="NewProductCharge">
        <section>
            <actions>
                <set field="titleProperty" value="Create New Product Charge"/>
                <set field="headerItem" value="productcharge"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createProductCharge"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!-- property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
                <set field="productChargeId" from-field="parameters.productChargeId"/>
                
                <entity-one entity-name="ProductCharge" value-field="productChargeContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="New Product Charge">
                                    <include-form name="NewProductCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Charges List">
                        			<include-form name="listProductCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- List Loan Products -->
    <screen name="FindLoanProduct">
        <section>
            <actions>
                <!-- set field="headerItem" value="ExampleMenuItem"/>
                <set field="titleProperty" value="PageTitleFindExample"/ -->
                <set field="headerItem" value="FindLoanProduct"/>
                <set field="titleProperty" value="Find Loan Product"/>
                <set field="loanProductCtx" from-field="parameters"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                        <container style="button-bar">
                                        
                                        <!-- link target="EditExampleLayer" link-type="ajax-window" height="500" width="500" text="${uiLabelMap.ExampleNewExample}" style="buttontext create"/ -->
                                        <link target="NewProductCharge" text="New Product Charge" style="buttontext create"></link>
                                        
                                        </container>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindLoanProduct" location="component://loans/widget/loans/LoanForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                        <include-form name="findListLoanProduct" location="component://loans/widget/loans/LoanForms.xml"/>
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">Permission Error</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!--  viewloanproductdetails -->
    <screen name="viewloanproductdetails">
        <section>
            <actions>
                <set field="titleProperty" value="Product Details"/>
                <set field="tabButtonItem" value="viewloanproductdetails"/>
                <set field="headerItem" value="viewloanproductdetails"/>
                <set field="labelTitleProperty" value="PartyTaxAuthInfos"/>
                <set field="loanProductId" from-field="parameters.loanProductId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                
                <entity-one entity-name="LoanProduct" value-field="loanProduct">
                                    <field-map field-name="loanProductId" from-field="parameters.loanProductId"/>
                </entity-one>
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                       
                        <section>
                            <condition>
                                <not><if-empty field="loanProduct"/></not>
                            </condition>
                            <widgets>
                                <!-- section>
                                    <condition>
                                        <if-compare field="showOld" operator="equals" value="true" type="Boolean"/>
                                    </condition>
                                    <widgets>
                                        <container style="button-bar button-style-2">
                                            <link target="viewmemberprofile" text="${uiLabelMap.PartyHideOld}">
                                                <parameter param-name="partyId" from-field="party.partyId"/>
                                            </link>
                                        </container>
                                    </widgets>
                                    <fail-widgets>
                                        <container style="button-bar button-style-2">
                                            <link target="viewmemberprofile" text="${uiLabelMap.PartyShowOld}">
                                                <parameter param-name="partyId" from-field="party.partyId"/>
                                                <parameter param-name="SHOW_OLD" value="true"/>
                                            </link>
                                        </container>
                                    </fail-widgets>
                                </section -->
                               
                                        <!-- include-portal-page id="PartyProfile"/ -->
                                        
                                   		<!-- include-portal-page id="ApplicationProfile"/ -->
                                   		<include-portal-page id="LoanProductProfile"/>
                               
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <!-- viewaccountproductdetails -->
     <screen name="viewaccountproductdetails">
        <section>
            <actions>
                <set field="titleProperty" value="Account Product Details"/>
                <set field="tabButtonItem" value="viewaccountproductdetails"/>
                <set field="headerItem" value="viewaccountproductdetails"/>
                <set field="labelTitleProperty" value="PartyTaxAuthInfos"/>
                <set field="accountProduct" from-field="parameters.accountProductId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                
                <entity-one entity-name="AccountProduct" value-field="accountProduct">
                                    <field-map field-name="accountProductId" from-field="parameters.accountProductId"/>
                </entity-one>
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                       
                        <section>
                            <condition>
                                <not><if-empty field="accountProduct"/></not>
                            </condition>
                            <widgets>
                                <!-- section>
                                    <condition>
                                        <if-compare field="showOld" operator="equals" value="true" type="Boolean"/>
                                    </condition>
                                    <widgets>
                                        <container style="button-bar button-style-2">
                                            <link target="viewmemberprofile" text="${uiLabelMap.PartyHideOld}">
                                                <parameter param-name="partyId" from-field="party.partyId"/>
                                            </link>
                                        </container>
                                    </widgets>
                                    <fail-widgets>
                                        <container style="button-bar button-style-2">
                                            <link target="viewmemberprofile" text="${uiLabelMap.PartyShowOld}">
                                                <parameter param-name="partyId" from-field="party.partyId"/>
                                                <parameter param-name="SHOW_OLD" value="true"/>
                                            </link>
                                        </container>
                                    </fail-widgets>
                                </section -->
                               
                                        <!-- include-portal-page id="PartyProfile"/ -->
                                        
                                   		<!-- include-portal-page id="ApplicationProfile"/ -->
                                   		<!-- include-portal-page id="LoanProductProfile"/ -->
                                   		<include-portal-page id="AccountProfile"/>
                               
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">Issue Display Account Product Details</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- FindAccountProduct -->
    <screen name="FindAccountProduct">
        <section>
            <actions>
                <!-- set field="headerItem" value="ExampleMenuItem"/>
                <set field="titleProperty" value="PageTitleFindExample"/ -->
                <set field="headerItem" value="FindAccountProduct"/>
                <set field="titleProperty" value="Find Account Product"/>
                <set field="accountProductCtx" from-field="parameters"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                        <container style="button-bar">
                                        
                                        <!-- link target="EditExampleLayer" link-type="ajax-window" height="500" width="500" text="${uiLabelMap.ExampleNewExample}" style="buttontext create"/ -->
                                        <link target="NewProductCharge" text="New Product Charge" style="buttontext create"></link>
                                        
                                        </container>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindAccountProduct" location="component://loans/widget/loans/LoanForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                        <include-form name="findListAccountProduct" location="component://loans/widget/loans/LoanForms.xml"/>
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">Permission Error</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- LoanProductExtraDetails -->
    <screen name="LoanProductExtraDetails">
        <section>
            <actions>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="parameters.loanProductId" from-field="parameters.loanProductId"/>
                
                <entity-one entity-name="LoanProduct" value-field="lookupLoanProduct">
                    <field-map field-name="loanProductId" from-field="parameters.loanProductId"/><!-- is required -->
                </entity-one>
                
             
             </actions>
            <widgets>
                <section>
                    <condition>
                        <not><if-empty field="lookupLoanProduct"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <or>
                                    <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                                    <if-compare-field field="parameters.partyId" operator="equals" to-field="userLogin.partyId"/>
                                </or>
                            </condition -->
                            <widgets>
                                <screenlet title="Product" navigation-menu-name="personUpdate" id="PartyPersonalInformationPanel">
                                           <!-- include-menu name="personUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/ -->
                                    <!-- include-form name="ViewPartyPerson" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                    <!-- include-form name="ViewLoanApplicationDetails" location="component://loans/widget/loans/LoanForms.xml"/ -->
                                    <section>
                                        <!--  condition -->
                                            <!--  not><if-empty field="partyNameHistoryList"/></not -->
                                            
                                            <!-- not><if-empty field="loanApplicationSecurityList"/></not -->
                                        <!-- /condition -->
                                        <widgets>
                                			<container>
                                				<label style="h3">Product Name    : ${lookupLoanProduct.name}</label>
                                				<label style="h3">Product Code    : ${lookupLoanProduct.code}</label>
                                				<label style="h3">Maximum Repayment : ${lookupLoanProduct.maxRepaymentPeriod}</label>
                                				<label style="h3">Interest Rate (P.M)    :  ${lookupLoanProduct.interestRatePM}</label>
                                            
                                            </container>
                                            <!-- include-form name="ViewPartyPersonHistory" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                            <screenlet title="Add Charge">
                                            	<include-form name="NewLoanProductCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Charges List">
                                            	<include-form name="listLoanProductCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                            </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            
                        </section>
                    </widgets>
                </section>
                <section>
                    <condition>
                        <not><if-empty field="lookupGroup"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                               </condition -->
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyPartyGroupInformation}" navigation-menu-name="groupUpdate" id="PartyGroupInformationPanel">
                                    <include-menu name="groupUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/>
                                    <include-form name="ViewPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyGroupHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <screenlet title="${uiLabelMap.PartyPartyGroupInformation}" id="PartyGroupInformationPanel">
                                    <include-form name="ViewPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyGroupHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </widgets>
                </section>
            </widgets>
        </section>
    </screen>
    
    <!-- AccountProductExtraDetails -->
    <!-- AccountProductExtraDetails Begin -->
     <screen name="AccountProductExtraDetails">
        <section>
            <actions>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="parameters.accountProductId" from-field="parameters.accountProductId"/>
                
                <entity-one entity-name="AccountProduct" value-field="lookupAccountProduct">
                    <field-map field-name="accountProductId" from-field="parameters.accountProductId"/><!-- is required -->
                </entity-one>
             </actions>
            <widgets>
                <section>
                    <condition>
                        <not><if-empty field="lookupAccountProduct"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <or>
                                    <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                                    <if-compare-field field="parameters.partyId" operator="equals" to-field="userLogin.partyId"/>
                                </or>
                            </condition -->
                            <widgets>
                                <screenlet title="Product" navigation-menu-name="personUpdate" id="PartyPersonalInformationPanel">
                                           <!-- include-menu name="personUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/ -->
                                    <!-- include-form name="ViewPartyPerson" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                    <!-- include-form name="ViewLoanApplicationDetails" location="component://loans/widget/loans/LoanForms.xml"/ -->
                                    <section>
                                        <!--  condition -->
                                            <!--  not><if-empty field="partyNameHistoryList"/></not -->
                                            
                                            <!-- not><if-empty field="loanApplicationSecurityList"/></not -->
                                        <!-- /condition -->
                                        <widgets>
                                			<container>
                                				<label style="h3">Product Name    : ${lookupAccountProduct.name}</label>
                                				<label style="h3">Product Code    : ${lookupAccountProduct.code}</label>
                                            
                                            </container>
                                            <!-- include-form name="ViewPartyPersonHistory" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                            <screenlet title="Add Charge">
                                            	<include-form name="NewAccountProductCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Charges List">
                                            	<include-form name="listAccountProductCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                            </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            
                        </section>
                    </widgets>
                </section>
                
            </widgets>
        </section>
    </screen>
    <!-- AccountProductExtraDetails End -->
    
    <!-- LoanApplicationCharges -->
    <screen name="LoanApplicationCharges">
        <section>
            <actions>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanApplication" value-field="lookupLoanApplication">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/><!-- is required -->
                </entity-one>
                
             
             </actions>
            <widgets>
                <section>
                    <condition>
                        <not><if-empty field="lookupLoanApplication"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <or>
                                    <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                                    <if-compare-field field="parameters.partyId" operator="equals" to-field="userLogin.partyId"/>
                                </or>
                            </condition -->
                            <widgets>
                                <screenlet title="Product" navigation-menu-name="personUpdate" id="PartyPersonalInformationPanel">
                                           <!-- include-menu name="personUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/ -->
                                    <!-- include-form name="ViewPartyPerson" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                    <!-- include-form name="ViewLoanApplicationDetails" location="component://loans/widget/loans/LoanForms.xml"/ -->
                                    <section>
                                        <!--  condition -->
                                            <!--  not><if-empty field="partyNameHistoryList"/></not -->
                                            
                                            <!-- not><if-empty field="loanApplicationSecurityList"/></not -->
                                        <!-- /condition -->
                                        <widgets>
                                			
                                            <!-- include-form name="ViewPartyPersonHistory" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                            <screenlet title="Add Charge">
                                            	<include-form name="NewLoanApplicationCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Charges List">
                                            	<include-form name="listLoanApplicationCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                            </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            
                        </section>
                    </widgets>
                </section>
                <section>
                    <condition>
                        <not><if-empty field="lookupGroup"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                               </condition -->
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyPartyGroupInformation}" navigation-menu-name="groupUpdate" id="PartyGroupInformationPanel">
                                    <include-menu name="groupUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/>
                                    <include-form name="ViewPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyGroupHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <screenlet title="${uiLabelMap.PartyPartyGroupInformation}" id="PartyGroupInformationPanel">
                                    <include-form name="ViewPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyGroupHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </widgets>
                </section>
            </widgets>
        </section>
    </screen>
    <screen name="amortizationSchedulePdf">
		<section>
			<actions>
				<set field="titleProperty" value="PageTitleEditExample" />
				<set field="tabButtonItem" value="AmortizationSchedule" />
				<set field="loanApplicationId" from-field="parameters.loanApplicationId" />
				<entity-one entity-name="LoanApplication" value-field="loanApplication" />
				<set field="viewSize" value="100000"/>
				
				<!-- entity-condition entity-name="LoanAmortization" list="listAmortizationSchedule" >
            		<condition-expr field-name="loanApplicationId" operator="equals" from-field="loanApplicationId"/>
            	</entity-condition -->
			</actions>
			<widgets>
			<!-- screenlet>
				<include-form name="listAmortizationSchedule"
							location="component://loans/widget/loans/LoanForms.xml" />
			</screenlet -->
				<decorator-screen name="FoReportDecorator" location="component://common/widget/CommonScreens.xml">
					<!-- decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}" -->
					<decorator-section name="body">
						<include-form name="listAmortizationSchedule"
							location="component://loans/widget/loans/LoanForms.xml" />
					</decorator-section>
				<!-- /decorator-screen -->
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	
	<!-- classifyProducts -->
	<screen name="classifyProducts">
        <section>
            <actions>
                <set field="titleProperty" value="Classify Loan Products"/>
                <set field="headerItem" value="classifyProducts"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createLoanProductClass"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!-- property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
                <!-- set field="loanSecurityId" from-field="parameters.loanSecurityId"/ -->
                
                <entity-one entity-name="LoanProductClass" value-field="loanProductClassContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="New Product Classification">
                                    <include-form name="NewLoanProductClass" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Product Classification List">
                        			<include-form name="listLoanProductClass" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="FindMember">
        <section>
            <actions>
                <set field="titleProperty" value="Members"/>
                <set field="headerItem" value="main"/>
                <set field="tabButtonItem" value="findmember"/>
                <set field="memberCtx" from-field="parameters"/>
				
                <!-- service service-name="listSaccoMembers" auto-field-map="parameters"/ -->
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <!-- do check for PARTYMGR, _VIEW permission -->
                            <condition>
                                <if-service-permission service-name="partyBasePermissionCheck" main-action="VIEW"/>
                            </condition>
                            <widgets>
                                <!-- platform-specific>
                                    <html><html-template location="component://party/webapp/partymgr/party/listsaccomembers.ftl"/></html>
                                </platform-specific -->
                                <screenlet title="Search Members">
                                        <include-form name="FindMember" location="component://loans/widget/loans/LoanForms.xml"/>
                            	</screenlet>
                                <screenlet title="Members List">
                                		<include-form  name="members" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3" text="${uiLabelMap.PartyMgrViewPermissionError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- changeLoanDetails -->
    <screen name="changeLoanDetails">
        <section>
            <actions>
                <set field="titleProperty" value="Change Loan Details"/>
                <set field="tabButtonItem" value="changeLoanDetails"/>
                <set field="headerItem" value="changeLoanDetails"/>
                <set field="labelTitleProperty" value="PartyTaxAuthInfos"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                
                <entity-one entity-name="LoanApplication" value-field="loanApplication">
                     <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                </entity-one>
                
                <entity-one entity-name="LoanApplication" value-field="lookupLoanApplication">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/><!-- is required -->
                </entity-one>
                
                <entity-one value-field="lookupLoanStatus" entity-name="LoanStatus">
                	<field-map field-name="name" value="${loanApplication.applicationStatus}"/>
                </entity-one>
                
                <entity-one value-field="member" entity-name="Member">
                	<field-map field-name="partyId" value="${loanApplication.partyId}"/>
                </entity-one>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                       
                        <section>
                            <condition>
                                <not><if-empty field="loanApplication"/></not>
                            </condition>
                            <widgets>

								<screenlet>
									<include-form name="ViewLoanApplicationDetails" location="component://loans/widget/loans/LoanForms.xml"/>
								</screenlet>
								<!-- LoanStatusChange -->
								<screenlet title="Change Loan Status for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanStatusChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanStatusChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<!-- LoanInterestChange -->
								<screenlet title="Change Interest Rate for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanInterestChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanInterestChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<!-- LoanAmountChange -->
								<screenlet title="Change Loan Amount for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanAmountChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanAmountChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<!-- LoanRepaymentPeriodChange -->
								<screenlet title="Change Repayment Period for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanRepaymentPeriodChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanRepaymentPeriodChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								
								<!--  LoanSalaryAmount -->
								<screenlet title="Change Salary Amount for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanSalaryAmount"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanSalaryAmount"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
									<!-- LoanGuarantorChange -->
								<screenlet title="Change Guarantors for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanGuarantorChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanGuarantorChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
                               
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
</screens>