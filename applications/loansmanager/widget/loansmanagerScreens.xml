<?xml version="1.0" encoding="UTF-8"?>
<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">

    <screen name="main">
        <section>
            <actions>
                <set field="headerItem" value="main"/><!-- this highlights the selected menu-item with name "main" -->
            </actions>
            <widgets>
                <decorator-screen name="loansmanagerCommonDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- forwardedLoanApplications -->
        <screen name="forwardedLoanApplications">
        <section>
            <actions>
                <set field="titleProperty" value="Create New Loan Application"/>
                <set field="headerItem" value="forwardedLoanApplications"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createLoanApplication"/>
                 <set field="loanApplicationCtx" from-field="parameters"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanApplication" value-field="applicationContext">
                	<field-map field-name="loanApplicationId" from-field="loanApplicationId"/>
                </entity-one>
                
              <entity-condition entity-name="LoanProduct" list="productsList">
             	 <!-- condition-expr field-name="productType" operator="equals" value="Loan"/ -->
            </entity-condition>
            <entity-condition entity-name="PaymentMethodType" list="paymentMethodsList">
            </entity-condition>
            <entity-condition entity-name="LoanStatus" list="loanStatusList">
            </entity-condition>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">

                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Search Appraised Loans">
                        			
                        			<include-form name="FindLoansAppraised" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                        		</screenlet>
                        		<screenlet title="Loan Applications">
                        			<include-form name="listAppraisedLoanApplications" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
          <screen name="approvedLoanApplications">
        <section>
            <actions>
                <set field="titleProperty" value="Approved Loan Application"/>
                <set field="headerItem" value="approvedLoanApplications"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createLoanApplication"/>
                <set field="loanApplicationCtx" from-field="parameters"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanApplication" value-field="applicationContext">
                	<field-map field-name="loanApplicationId" from-field="loanApplicationId"/>
                </entity-one>
			 <!-- condition-expr field-name="productType" operator="equals" value="Loan"/ -->
             <entity-condition entity-name="LoanProduct" list="productsList">
             	
            </entity-condition>
            <entity-condition entity-name="PaymentMethodType" list="paymentMethodsList">
            </entity-condition>
            <entity-condition entity-name="LoanStatus" list="loanStatusList">
            </entity-condition>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">

                        <section name="search-results">
                        	<widgets>
                        		<screenlet>
                        			
                        			<include-form name="FindLoansApproved" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                        		</screenlet>
                        		<screenlet title="Loan Applications">
                        			<include-form name="listApprovedLoanApplications" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    
        <screen name="rejectedLoanApplications">
        <section>
            <actions>
                <set field="titleProperty" value="Rejected Loan Application"/>
                <set field="headerItem" value="rejectedLoanApplications"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createLoanApplication"/>
                <set field="loanApplicationCtx" from-field="parameters"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanApplication" value-field="applicationContext">
                    <field-map field-name="loanApplicationId" from-field="loanApplicationId"/>
                </entity-one>
             <!-- condition-expr field-name="productType" operator="equals" value="Loan"/ -->
             <entity-condition entity-name="LoanProduct" list="productsList">
                
            </entity-condition>
            <entity-condition entity-name="PaymentMethodType" list="paymentMethodsList">
            </entity-condition>
            <entity-condition entity-name="LoanStatus" list="loanStatusList">
            </entity-condition>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">

                        <section name="search-results">
                            <widgets>
                                <screenlet>
                                    <include-form name="FindLoansRejected" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                                </screenlet>
                                <screenlet title="Loan Applications">
                                    <include-form name="listRejectedLoanApplications" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                                </screenlet>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

        <screen name="loanTopUp">
        <section>
            <actions>
                <set field="titleProperty" value="Top Up Loan"/>
                <set field="headerItem" value="loanTopUp"/>
                <set field="displayPassword" value="Y"/>
                <set field="loanApplicationCtx" from-field="parameters"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section name="search-results">
                        	<widgets>
                        		<screenlet>
                        			<include-form name="FindLoansToTop" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                        		</screenlet>
                        		<screenlet title="Loan Applications">
                        			<include-form name="ListLoansToTop" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="topUpLoan">
        <section>
            <actions>
                <set field="headerItem" value="Top up Loan" />
                <set field="headerItem" value="loanTopUp"/>
                <set field="titleProperty" value="Top up Loan" />
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                <entity-one entity-name="LoanApplication" value-field="loanApplication">
                    <field-map field-name="loanApplicationId" from-field="loanApplicationId"/>
                </entity-one>
               <set field="debitAmount" type="BigDecimal" value="0.00"/>
               <set field="originalAppliedAmount" type="BigDecimal" value="${bsh:org.ofbiz.accounting.finaccount.FinAccountServices.getOriginalAppliedAmount(delegator,loanApplicationId)}"/>
               <set field="originalDisbursedAmount" type="BigDecimal" value="${bsh:org.ofbiz.accounting.finaccount.FinAccountServices.getOriginalDisbursedAmount(delegator,loanApplicationId)}"/>
               <set field="maximumTopupAmount" type="BigDecimal" value="${bsh:org.ofbiz.accounting.finaccount.FinAccountServices.getMaxAcceptableTopupAmount(delegator,loanApplicationId)}"/>
               <!-- <set field="creditAmount" from-field="multiPayment.amount"/> -->
                <entity-and entity-name="MultiPaymentLines" list="listMultiPaymentLines">
                    <field-map field-name="paymentId" from-field="paymentId" />
                </entity-and>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <not>
                                    <if-empty field="loanApplication"/>
                                </not>
                            </condition>
                            <widgets>
                                <screenlet title="Loan Information">
                                    <include-form name="LoanHeaderApplicationDetails" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                                </screenlet>
                                <screenlet title="Request Loan Top Up">
                                    <container><label style="h3" text="Original Applied Amount: ${originalAppliedAmount}  |  Original Disbursed Amount: ${originalDisbursedAmount} |  Maximum Acceptable  Top Amount: ${maximumTopupAmount}"></label></container>
                                    <include-form name="RequestTopUp" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <screenlet title="Loan Information">
                                    <include-form name="LoanHeaderApplicationDetails" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                                </screenlet>
                                <screenlet title="Top Up Loan Details">
                                    <include-form name="RequestTopUpDetails" location="component://accounting/widget/PaymentForms.xml"/>
                                     <container><label style="h3" text="Total Loan Amount: ${creditAmount}  Maximum Top Up Amount: ${debitAmount}  Requested Amount : ${totalLines}"></label></container>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    
    
     <screen name="rejectionLetterReport">
        <section>
            <actions>
                <property-map resource="CommonUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="viewSize" value="99999"/>
                <script location="component://loanreports/webapp/loanreports/WEB-INF/actions/reports/rejectionReport.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="SimpleDeoratorRepp" location="component://common/widget/CommonScreens.xml">
                    <decorator-section name="body">
                        <platform-specific>
                            <xsl-fo><html-template location="component://loanreports/webapp/loanreports/reports/rejectionReport.fo.ftl"/></xsl-fo>
                        </platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
     <screen name="viewapplicationprofile">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleViewPartyProfile"/>
                <set field="tabButtonItem" value="viewprofile"/>
                <set field="headerItem" value="loanapplicationslist"/>
                <set field="labelTitleProperty" value="PartyTaxAuthInfos"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                <entity-one entity-name="LoanApplication" value-field="loanApplication">
                                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                </entity-one>
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <not><if-empty field="loanApplication"/></not>
                            </condition>
                            <widgets>
                           	<include-portal-page id="ApplicationProfile"/>
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- LoanApplication -->
    <screen name="LoanApplication">
        <section>
            <actions>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="parameters.loanApplicationId" from-field="parameters.loanApplicationId"/>
                <entity-and entity-name="PartyNameHistory" list="partyNameHistoryList">
                    <field-map field-name="partyId" from-field="parameters.partyId"/>
                    <order-by field-name="-changeDate"/>
                </entity-and>
                <entity-one entity-name="PartyAndGroup" value-field="lookupGroup">
                    <field-map field-name="partyId" from-field="parameters.partyId"/><!-- is required -->
                </entity-one>
                <entity-one entity-name="LoanApplication" value-field="lookupLoanApplication">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/><!-- is required -->
                </entity-one>
                
                <entity-one value-field="lookupLoanStatus" entity-name="LoanStatus">
                	<field-map field-name="name" value="${loanApplication.applicationStatus}"/>
                </entity-one>
                
                <!-- entity-one entity-name="SaccoProduct" value-field="lookupLoanType">
                    <field-map field-name="saccoProductId" from-field="lookupLoanApplication.saccoProductId"/>
                </entity-one -->
                <entity-one entity-name="LoanProduct" value-field="lookupLoanType">
                    <field-map field-name="loanProductId" from-field="lookupLoanApplication.loanProductId"/><!-- is required -->
                </entity-one>
                
                <entity-one entity-name="PaymentMethodType" value-field="lookupPaymentMethodType">
                    <field-map field-name="paymentMethodTypeId" from-field="lookupLoanApplication.paymentMethodTypeId"/><!-- is required -->
                </entity-one>
                
                
                 <entity-one entity-name="LoanStatus" value-field="lookupLoanStatus">
                    <field-map field-name="name" from-field="lookupLoanApplication.name"/><!-- is required -->
                </entity-one>
                
                <entity-and entity-name="LoanApplicationSecurity" list="loanApplicationSecurityList">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                    <!--  order-by field-name="-changeDate"/ -->
                </entity-and>
                
                 <entity-and entity-name="LoanApplicationCallateral" list="loanApplicationCallateralList">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                    <!--  order-by field-name="-changeDate"/ -->
                    
                </entity-and>
                
                 <entity-and entity-name="LoanGuarantor" list="loanGuarantorsList">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                    <!--  order-by field-name="-changeDate"/ -->
                </entity-and>
                
                
                
                <entity-and list="partyContentList" entity-name="PartyContent">
                    <field-map field-name="partyId" from-field="parameters.partyId"/>
                    <field-map field-name="partyContentTypeId" value="LGOIMGURL"/>
                    <order-by field-name="-fromDate"/>
                </entity-and>
                <set field="partyContentId" from-field="partyContentList[0].contentId"/>
                <set field="partyContent" value="${groovy: partyContentId!=null?&quot;/content/control/stream?contentId=&quot; + partyContentId : &quot;&quot;}"/>
                <set field="partyGroupLogoLinkUrl" from-field="partyContent" default-value="${lookupGroup.logoImageUrl}" global="true"/>
                <set field="personalImage" from-field="partyContent"/>
                
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <set field="collateralsAvailable" value="${bsh:org.ofbiz.loans.LoanServices.loanHasCollateral(loanApplicationId);}" type="String"   />
				<set field="guarantorsAvailable" value="${bsh:org.ofbiz.loans.LoanServices.loanHasGuarantors(loanApplicationId);}" type="String"   />
				<set field="guarantorsTotalDepositsEnough" value="${bsh:org.ofbiz.loans.LoanServices.guarantorTotalsEqualLoanTotal(loanApplicationId);}" type="String"   />
				<!-- set field="eacherGuarantorGreaterThanAverage" value="${bsh:org.ofbiz.loans.LoanServices.checkEachGuarantorDepositGreaterThanAverage(loanApplicationId);}" type="String"   /-->
                
            </actions>
            <widgets>
                <section>
                    <condition>
                        <not><if-empty field="lookupLoanApplication"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <or>
                                    <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                                    <if-compare-field field="parameters.partyId" operator="equals" to-field="userLogin.partyId"/>
                                </or>
                            </condition -->
                            <widgets>
                            	<!-- section>
									<condition>
										<and>
											<if-compare operator="equals" value="N" field="collateralsAvailable"/>
											<if-compare operator="equals" value="N" field="guarantorsAvailable"/>
										</and>
										
									</condition>
									<widgets>
										<container>
									
												<label  style="h3"> Loan Application must have Collateral or Guarantors - Please Add</label>
										</container>
									</widgets>
								</section -->
								
								<section>
									<condition>
										<and>
											<if-compare operator="equals" value="N" field="collateralsAvailable"/>
											<if-compare operator="equals" value="N" field="guarantorsAvailable"/>
										</and>
									</condition>
									<widgets>
										<container>
									
												<label style="h3"> Please provide Guarantors or Collateral</label>
										</container>
									</widgets>
								</section>
								
								<section>
									<condition>
										<if-compare operator="equals" value="N" field="guarantorsTotalDepositsEnough"/>
									</condition>
									<widgets>
										<container>
									
												<label style="h3"> Guarantors total deposit is not enough (Sum of Guarantor deposits must be more or equal to the loan amount)</label>
										</container>
									</widgets>
								</section>
								
								
								<!-- section>
									<condition>
										<if-compare operator="equals" value="N" field="eacherGuarantorGreaterThanAverage"/>
									</condition>
									<widgets>
										<container>
									
												<label style="h3"> Each Guarantor must have enough deposit for his/her share of the loan guaranteed </label>
										</container>
									</widgets>
								</section -->
                            
                                <screenlet title="Loan Information" navigation-menu-name="personUpdate" id="PartyPersonalInformationPanel">
                                           <!-- include-menu name="personUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/ -->
                                    <!-- include-form name="ViewPartyPerson" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                    <include-form name="ViewLoanApplicationDetails" location="component://loans/widget/loans/LoanForms.xml"/>
                                    <section>
                                        <!--  condition -->
                                            <!--  not><if-empty field="partyNameHistoryList"/></not -->
                                            
                                            <!-- not><if-empty field="loanApplicationSecurityList"/></not -->
                                        <!-- /condition -->
                                        <widgets>
                                            <!-- include-form name="ViewPartyPersonHistory" location="component://party/widget/partymgr/PartyForms.xml"/ -->
                                            <screenlet title="Add Loan Security">
                                            	<include-form name="NewLoanApplicationSecurity" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Loan Security List">
                                            	<include-form name="ViewLoanSecurityList" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                             <screenlet title="Add Collateral">
                                            	<include-form name="NewCollateral" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Collateral List">
                                            	<include-form name="ViewLoanCollateralList" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                             <screenlet title="Add Guarantor">
                                            	<include-form name="NewGuarantor" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Guarantors List">
                                            	<include-form name="ViewLoanGuarantorsList" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                             <screenlet title="Add Charge">
                                            	<include-form name="NewLoanApplicationCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            <screenlet title="Charges List">
                                            	<include-form name="listLoanApplicationCharge" location="component://loans/widget/loans/LoanForms.xml"/>
                                            </screenlet>
                                            
                                            </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <screenlet title="${uiLabelMap.PartyPersonalInformation}" id="PartyPersonalInformationPanel">
                                    <include-form name="ViewPartyPerson" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyPersonHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </widgets>
                </section>
                <section>
                    <condition>
                        <not><if-empty field="lookupGroup"/></not>
                    </condition>
                    <widgets>
                        <section>
                            <!-- condition>
                                <if-has-permission permission="PARTYMGR" action="_GRP_UPDATE"/>
                               </condition -->
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyPartyGroupInformation}" navigation-menu-name="groupUpdate" id="PartyGroupInformationPanel">
                                    <include-menu name="groupUpdate" location="component://party/widget/partymgr/PartyMenus.xml"/>
                                    <include-form name="ViewPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyGroupHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <screenlet title="${uiLabelMap.PartyPartyGroupInformation}" id="PartyGroupInformationPanel">
                                    <include-form name="ViewPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <not><if-empty field="partyNameHistoryList"/></not>
                                        </condition>
                                        <widgets>
                                            <include-form name="ViewPartyGroupHistory" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </widgets>
                </section>
            </widgets>
        </section>
    </screen>
    
    <!-- 
    	reviewLoan
    	appraiseLoan
    	approveLoan
    	disburseLoan
     -->
     <!-- reviewLoan -->
     <screen name="reviewLoan">
        <section>
            <actions>
                <set field="titleProperty" value="Review Loan"/>
                <set field="headerItem" value="reviewLoan"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createReviewLoan"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!--  property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanStatusLog" value-field="loanStatusLogContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="Review Loan">
                                    <include-form name="reviewLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Review Log">
                        			<include-form name="listReviewLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
     
     <!-- appraiseLoan -->
     <screen name="appraiseLoan">
        <section>
            <actions>
                <set field="titleProperty" value="Appraise Loan"/>
                <set field="headerItem" value="appraiseLoan"/>
                <set field="displayPassword" value="Y"/>
                <set field="target" value="createAppraiseLoan"/>
                <set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_"/>
                <!--  property-to-field field="defaultCountryGeoId" resource="general" property="KEN" default="KEN"/ -->
               <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                
                <entity-one entity-name="LoanStatusLog" value-field="loanStatusLogContext"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="LOANS" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="Appraise Loan">
                                    <include-form name="appraiseLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                        
                        <section name="search-results">
                        	<widgets>
                        		<screenlet title="Appraisal Log">
                        			<include-form name="listAppraiseLoan" location="component://loans/widget/loans/LoanForms.xml"/>
                        		</screenlet>
                        	</widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- changeLoanDetails -->
    <screen name="changeLoanDetails">
        <section>
            <actions>
                <set field="titleProperty" value="Change Loan Details"/>
                <set field="tabButtonItem" value="changeLoanDetails"/>
                <set field="headerItem" value="changeLoanDetails"/>
                <set field="labelTitleProperty" value="PartyTaxAuthInfos"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                
                <entity-one entity-name="LoanApplication" value-field="loanApplication">
                     <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                </entity-one>
                
                <entity-one entity-name="LoanApplication" value-field="lookupLoanApplication">
                    <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/><!-- is required -->
                </entity-one>
                
                <entity-one value-field="lookupLoanStatus" entity-name="LoanStatus">
                	<field-map field-name="name" value="${loanApplication.applicationStatus}"/>
                </entity-one>
                
                <entity-one value-field="member" entity-name="Member">
                	<field-map field-name="partyId" value="${loanApplication.partyId}"/>
                </entity-one>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                       
                        <section>
                            <condition>
                                <not><if-empty field="loanApplication"/></not>
                            </condition>
                            <widgets>

								<screenlet>
									<include-form name="ViewLoanApplicationDetails" location="component://loans/widget/loans/LoanForms.xml"/>
								</screenlet>
								<!-- LoanStatusChange -->
								<screenlet title="Change Loan Status for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanStatusChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanStatusChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<!-- LoanInterestChange -->
								<screenlet title="Change Interest Rate for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanInterestChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanInterestChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<!-- LoanAmountChange -->
								<screenlet title="Change Loan Amount for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanAmountChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanAmountChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<!-- LoanRepaymentPeriodChange -->
								<screenlet title="Change Repayment Period for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanRepaymentPeriodChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanRepaymentPeriodChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								
								<!--  LoanSalaryAmount -->
								<screenlet title="Change Salary Amount for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanSalaryAmount"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanSalaryAmount"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
									<!-- LoanGuarantorChange -->
								<screenlet title="Change Guarantors for Loan No - ${loanApplication.loanNo} for  ${member.firstName} ${member.lastName}">
									<include-form name="LoanGuarantorChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
								<screenlet title="List">
									<include-form name="listLoanGuarantorChange"
										location="component://loans/widget/loans/LoanForms.xml" />
								</screenlet>
                               
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- approveLoan -->
     <screen name="approveLoan">
       <section>
            <actions>
                <set field="titleProperty" value="Approval"/>
                <set field="tabButtonItem" value="approveLoan"/>
                <set field="headerItem" value="approveLoan"/>
                <set field="labelTitleProperty" value="Approve Loan"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                
                <entity-one entity-name="LoanApplication" value-field="loanApplication">
                           <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                </entity-one>
                <set field="partyId" from-field="loanApplication.partyId"/>
                
                <set field="memberNumber" from-field="loanApplication.memberNumber"/>
                <set field="approvedAmt" value="${loanApplication.loanAmt}"/>
                <set field="loanAmt" value="${loanApplication.loanAmt}"/>
                
                <set field="theloanApplicationId" from-field="parameters.loanApplicationId" type="Long"/> 
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                       
                        <section>
                            <condition>
                                <not><if-empty field="loanApplication"/></not>
                            </condition>
                            <widgets>
                            <screenlet title="Approval">
                                       <include-form name="NewApproval" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                                 </screenlet>
                               <screenlet title="List">
                                       <include-form name="loanLogs" location="component://loansprocessing/widget/loansprocessingForms.xml"/>
                                 </screenlet>
                               
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- returnToLoans -->
         <screen name="returnToLoans">
       <section>
            <actions>
                <set field="titleProperty" value="Return To Loans"/>
                <set field="tabButtonItem" value="returnToLoans"/>
                <set field="headerItem" value="returnToLoans"/>
                <set field="labelTitleProperty" value="Return to Loans"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                
                <entity-one entity-name="LoanApplication" value-field="loanApplication">
                           <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                </entity-one>
                <set field="partyId" from-field="loanApplication.partyId"/>
                
                <set field="memberNumber" from-field="loanApplication.memberNumber"/>
                <set field="approvedAmt" value="${loanApplication.loanAmt}"/>
                 
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                       
                        <section>
                            <condition>
                                <not><if-empty field="loanApplication"/></not>
                            </condition>
                            <widgets>
                            <screenlet title="Return To Loans">
                                       <include-form name="NewReturnToLoans" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                                 </screenlet>
                               <screenlet title="List">
                                       <include-form name="loanLogs" location="component://loansprocessing/widget/loansprocessingForms.xml"/>
                                 </screenlet>
                               
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
     <!--Loan Reject Reason -->
         <screen name="rejectLoanReason">
       <section>
            <actions>
                <set field="titleProperty" value="reason For Rejecting Loans"/>
                <set field="tabButtonItem" value="rejectLoanReason"/>
                <set field="headerItem" value="rejectLoanReason"/>
                <set field="labelTitleProperty" value="Return to Loans"/>
                <set field="loanApplicationId" from-field="parameters.loanApplicationId"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/js/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                
                <entity-one entity-name="LoanApplication" value-field="loanApplication">
                           <field-map field-name="loanApplicationId" from-field="parameters.loanApplicationId"/>
                </entity-one>
                <set field="partyId" from-field="loanApplication.partyId"/>
                
                <set field="memberNumber" from-field="loanApplication.memberNumber"/>
                <set field="approvedAmt" value="${loanApplication.loanAmt}"/>
                 
            </actions>
            <widgets>
                <decorator-screen name="CommonLoanApplicationDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                       
                        <section>
                            <condition>
                                <not><if-empty field="loanApplication"/></not>
                            </condition>
                            <widgets>
                            <screenlet title="Reject Loan">
                                       <include-form name="rejectLoanReason" location="component://loansmanager/widget/loansmanagerForms.xml"/>
                                 </screenlet>
                               <screenlet title="Logs">
                                       <include-form name="loanLogs" location="component://loansprocessing/widget/loansprocessingForms.xml"/>
                                 </screenlet>
                               
                            </widgets>
                            <fail-widgets>
                                <container>
                                    <label style="h3">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

</screens>