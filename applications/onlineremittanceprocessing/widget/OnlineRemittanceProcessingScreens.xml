<?xml version="1.0" encoding="UTF-8"?>
<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">

	<screen name="main">
		<section>
			<actions>
				<set field="headerItem" value="main" /><!-- this highlights the selected 
					menu-item with name "main" -->
			</actions>
			<widgets>
				<decorator-screen name="OnlineRemittanceProcessingCommonDecorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">
					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>

	<screen name="manageOnlineStations">
		<section>
			<actions>
				<set field="titleProperty" value="Online Stations (Online Remittance Stations)" />
				<set field="headerItem" value="manageOnlineStations" />
				<set field="displayPassword" value="Y" />
				<set field="target" value="createOnlineStationItem" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				
				<set field="stationCount"
					value="${bsh:org.ofbiz.onlineremittanceprocessing.OnlineRemittanceProcessingServices.getOnlineStationsCount();}"
					type="Long" />
				<property-to-field field="defaultCountryGeoId"
					resource="general" property="KEN" default="KEN" />
			</actions>
			<widgets>
				<decorator-screen name="main-decorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">

						<section>


							<widgets>

								<screenlet>
									<section>
										<widgets>
											<container style="button-bar">
												<link target="addAllStationsOnline" text="Add All Stations to Online"
													style="buttontext">
													<image url-mode="raw" src="${iconsLocation}/add.png" />
												</link>
											</container>
										</widgets>
									</section>
								</screenlet>

								<screenlet>
									<section>
										<widgets>

											<container style="button-bar">
												<link target="removeAllStationsOnline" text="Remove All Stations Online"
													style="buttontext">
													<!-- parameter param-name="loanApplicationId"/ -->
													<image url-mode="raw" src="${iconsLocation}/add.png" />
												</link>
											</container>
										</widgets>
									</section>
								</screenlet>

							</widgets>
						</section>

						<section>
							<widgets>
								<screenlet title="Add Online Station">
									<include-form name="NewOnlineStation"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>
						<section name="search-results">
							<widgets>
								<!-- screenlet> <include-form name="FindLoansForwarded" location="component://loansprocessing/widget/loansprocessingForms.xml"/> 
									</screenlet -->
								<screenlet title="Online Stations (for Online Remittance)">
									<include-form name="manageOnlineStations"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>

						<!-- Total Stations Online -->
						<section>
							

							<widgets>

								<screenlet>

									<container>
										<label style="h3"> Online Stations Count : ${stationCount}</label>
									</container>
								</screenlet>
							</widgets>
						</section>
					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	
	<!-- pushMonthYear -->
		<screen name="pushMonthYear">
		<section>
			<actions>
				<set field="titleProperty" value="Push/Pull (Push/Pull Month Year)" />
				<set field="headerItem" value="pushMonthYear" />
				<set field="displayPassword" value="Y" />
				<set field="target" value="createPushMonthYear" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				
				<property-to-field field="defaultCountryGeoId"
					resource="general" property="KEN" default="KEN" />
			</actions>
			<widgets>
				<decorator-screen name="main-decorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">

						<section>
							<widgets>
								<screenlet title="Push/Pull Month Year">
									<include-form name="NewPushMonthYear"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>
						<section name="search-results">
							<widgets>
								<!-- screenlet> <include-form name="FindLoansForwarded" location="component://loansprocessing/widget/loansprocessingForms.xml"/> 
									</screenlet -->
								<screenlet title="Push/Pull (Month Year)">
									<include-form name="pushMonthYear"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>


					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	
	<!-- pushMonthYearStation -->
			<screen name="pushMonthYearStation">
		<section>
			<actions>
				<set field="titleProperty" value="Generate/Push and Pull Station" />
				<set field="headerItem" value="pushMonthYearStation" />
				<set field="displayPassword" value="Y" />
				<set field="target" value="createPushMonthYearStation" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				
				<property-to-field field="defaultCountryGeoId"
					resource="general" property="KEN" default="KEN" />
			</actions>
			<widgets>
				<decorator-screen name="main-decorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">

						<section>
							<widgets>
								<screenlet title="Generate and Push/Pull Month Year">
									<include-form name="NewPushMonthYearStation"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>
						<section name="search-results">
							<widgets>
								<!-- screenlet> <include-form name="FindLoansForwarded" location="component://loansprocessing/widget/loansprocessingForms.xml"/> 
									</screenlet -->
								<screenlet title="Generate Push/Pull (Month Year) Station">
									<include-form name="pushMonthYearStation"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>


					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	
	<!-- stationCodeMap -->
	<screen name="stationProductCodeMap">
		<section>
			<actions>
				<set field="titleProperty" value="Map Station Product Code" />
				<set field="headerItem" value="StationProductCodeMap" />
				<set field="displayPassword" value="Y" />
				<set field="target" value="createStationProductCodeMap" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				
				<property-to-field field="defaultCountryGeoId"
					resource="general" property="KEN" default="KEN" />
			</actions>
			<widgets>
				<decorator-screen name="main-decorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">

						<section>
							<widgets>
								<screenlet title="Map Station Product Code">
									<include-form name="NewStationProductCodeMap"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>
						<section name="search-results">
							<widgets>
								<!-- screenlet> <include-form name="FindLoansForwarded" location="component://loansprocessing/widget/loansprocessingForms.xml"/> 
									</screenlet -->
								<screenlet title="Map Station Product Code">
									<include-form name="listStationProductCodeMap"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>


					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
		<!-- 
		showStationPushStatus
	
	 -->
	 <screen name="showStationPushStatus">
		<section>
			<actions>
				<set field="titleProperty" value="Station Push Status" />
				<set field="headerItem" value="pushMonthYear" />
				<set field="displayPassword" value="Y" />
				<set field="target" value="createPushMonthYearItem" />
				<set field="pushMonthYearItemCtx" from-field="parameters" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				<set field="pushMonthYearId" from-field="parameters.pushMonthYearId" type="Long" global="true"/>
				
				<property-to-field field="defaultCountryGeoId"
					resource="general" property="KEN" default="KEN" />
			</actions>
			<widgets>
				<decorator-screen name="main-decorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">
						<section name="search-results">
							<widgets>
								<!-- screenlet> <include-form name="FindLoansForwarded" location="component://loansprocessing/widget/loansprocessingForms.xml"/> 
									</screenlet -->
								<screenlet title="Find Station">
									<include-form name="FindStationPushStatus"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
								<screenlet title="Station Push Status">
									<include-form name="showStationPushStatus"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>
					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	 
	 <!-- showStationPullStatus -->
	 <screen name="showStationPullStatus">
		<section>
			<actions>
				<set field="titleProperty" value="Station Pull Status" />
				<set field="headerItem" value="showStationPullStatus" />
				<set field="displayPassword" value="Y" />
				<set field="target" value="createPullMonthYearItem" />
				<set field="pullMonthYearItemCtx" from-field="parameters" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				<set field="pushMonthYearId" from-field="parameters.pushMonthYearId" type="Long" global="true"/>
				<property-to-field field="defaultCountryGeoId"
					resource="general" property="KEN" default="KEN" />
			</actions>
			<widgets>
				<decorator-screen name="main-decorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">

						<section name="search-results">
							<widgets>
								<screenlet title="Find Station">
									<include-form name="FindStationPullStatus"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>

								<screenlet title="Station Pull Status">
									<include-form name="showStationPullStatus"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>


					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	
	<!-- showGeneratedExpectation -->
	<!-- screen name="showGeneratedExpectation">
		<section>
			<actions>
				<set field="titleProperty" value="Show Generated Expectation" />
				<set field="headerItem" value="showGeneratedExpectation" />
				<set field="displayPassword" value="Y" />
				<set field="target" value="createExpectedPaymentSent" />
				<set field="expectedPaymentSentCtx" from-field="parameters" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				<set field="pushMonthYearStationId" from-field="parameters.pushMonthYearStationId" type="Long" global="true"/>
				<property-to-field field="defaultCountryGeoId"
					resource="general" property="KEN" default="KEN" />
			</actions>
			<widgets>
				<decorator-screen name="main-decorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">

						<section name="search-results">
							<widgets>
								<screenlet title="Find ">
									<include-form name="FindStationPullStatus"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet >

								<screenlet title="Show Expectations">
									<include-form name="showGeneratedExpectationsToBeSent"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>
							</widgets>
						</section>


					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen -->
	
	<screen name="showGeneratedExpectation">
		<section>
			<actions>
				<set field="titleProperty" value="Expected Payment Breakdown" />
				<set field="headerItem" value="pushMonthYearStation" />
				<set field="tabButtonItem" value="pushMonthYearStation" />

				<set field="displayPassword" value="Y" />
				<set field="target" value="createExpectedPaymentSent" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				<set field="expectedPaymentBreakdownCtx" from-field="parameters" />
				<!-- property-to-field field="defaultCountryGeoId" resource="general"
					property="KEN" default="KEN"/ -->
				<!-- set field="loanSecurityId" from-field="parameters.loanSecurityId"/ -->
				<set field="pushMonthYearStationId" from-field="parameters.pushMonthYearStationId" type="Long"/>
				
				<entity-one value-field="pushMonthYearStation" entity-name="PushMonthYearStation">
					<field-map field-name="pushMonthYearStationId" from-field="pushMonthYearStationId"/>
				</entity-one>
				<entity-one value-field="station" entity-name="Station">
					<field-map field-name="stationId" from-field="pushMonthYearStation.stationId"/>
				</entity-one>
				<set field="employerCode" from-field="station.employerCode"></set>
				
				<set field="employerName"
					value="${bsh:org.ofbiz.accountholdertransactions.RemittanceServices.getEmployerName(employerCode);}"
					type="String" />
				<set field="month" from-field="pushMonthYearStation.month" type="PlainString" />
				<set field="year" from-field="pushMonthYearStation.year" type="PlainString" />
				<set field="totalExpected" global="true"
					value="${bsh:org.ofbiz.accountholdertransactions.RemittanceServices.getTotalExpected(employerCode, month, pushMonthYearStationId);}"
					type="BigDecimal" />
				<set field="totalRemitted" global="true"
					value="${bsh:org.ofbiz.accountholdertransactions.RemittanceServices.getTotalRemitted(employerCode, month, pushMonthYearStationId);}"
					type="BigDecimal" />
				<set field="totalChequeAmount" global="true"
					value="${bsh:org.ofbiz.accountholdertransactions.RemittanceServices.getTotalRemittedChequeAmount(employerCode, month);}"
					type="BigDecimal" />

				<entity-one entity-name="ExpectedPaymentSent"
					value-field="expectedPaymentSentContext" />
					

			</actions>
			<widgets>
				<decorator-screen name="OnlineRemittanceProcessingCommonDecorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">
						<!-- include-menu
							location="component://accountholdertransactions/widget/accountholdertransactions/AccHolderTransactionsMenus.xml"
							name="expectedPaymentsTabBar" / -->
						<!-- section> <condition> <if-has-permission permission="ACCOUNTHOLDER"
							action="_CREATE"/> </condition> <widgets> <screenlet title="Expected Payment">
							<include-form name="NewExpectedPayment" location="component://accountholdertransactions/widget/accountholdertransactions/AccHolderTransactionsForms.xml"/>
							</screenlet> </widgets> <fail-widgets> <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
							</fail-widgets> </section -->
						<section>
							<widgets>
								<screenlet>
									<section>

										<widgets>

											<container style="button-bar">
												<label style="h3">Expected Payments from ${employerName}
													for ${month}${year} </label>
												<!-- parameter param-name="loanApplicationId"/ -->
												<!-- link
													target="expectedPaymentBreakdownpdf.pdf?month=${month}&amp;employerCode=${employerCode}"
													text="Print Expected Payment Breakdown" style="buttontext">
													
													<image url-mode="raw"
														src="${iconsLocation}/page_white_acrobat.png" />
												</link>

												<link
													target="expectedPaymentBreakdowncsv.csv?month=${month}&amp;employerCode=${employerCode}"
													text="Generate Expected Payment Breakdown CSV" style="buttontext">
													<image url-mode="raw" src="${iconsLocation}/page_excel.png" />

												</link -->
												
												<link
													target="expectedRemittanceExport.csv?pushMonthYearStationId=${pushMonthYearStationId}"
													text="Expected Remittance CSV (Download)" style="buttontext">
													<image url-mode="raw" src="${iconsLocation}/page_excel.png" />

												</link>
											</container>
										</widgets>

									</section>
								</screenlet>
							</widgets>
						</section>

						<section name="Expected Payment Breakdown">
							<widgets>
								<!--screenlet title="Find Expected Payment Sent">
									<include-form name="FindExpectedPaymentSent"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet -->
								<screenlet title="Expected Payment Breakdown">
									<include-form name="listExpectedPaymentSentBreakdown"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>


																<screenlet>
									<!-- include-form name="listExpectedPaymentReceivedBreakdownTotals"
										location="component://accountholdertransactions/widget/accountholdertransactions/AccHolderTransactionsForms.xml"/ -->
									<section>
										<widgets>
											<container style="button-bar">
												<label style="h3">Total Expected : Kshs. ${totalExpected}
												</label>
												<label style="h3">Total Received (Schedule) : Kshs.
													${totalRemitted} </label>
												<label style="h3">Total Received (Cheque Amount) : Kshs.
													${totalChequeAmount} </label>


											</container>
										</widgets>
									</section>
								</screenlet>
							</widgets>
						</section>
					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	
	<!-- showReceivedRemittance -->
	<screen name="showReceivedRemittance">
		<section>
			<actions>
				<set field="titleProperty" value="Received Remittance" />
				<set field="headerItem" value="pushMonthYearStation" />
				<set field="tabButtonItem" value="pushMonthYearStation" />

				<set field="displayPassword" value="Y" />
				<set field="target" value="createExpectedPaymentSent" />
				<set field="previousParams" from-field="sessionAttributes._PREVIOUS_PARAMS_" />
				<set field="expectedPaymentBreakdownCtx" from-field="parameters" />
				<!-- property-to-field field="defaultCountryGeoId" resource="general"
					property="KEN" default="KEN"/ -->
				<!-- set field="loanSecurityId" from-field="parameters.loanSecurityId"/ -->
				<set field="pushMonthYearStationId" from-field="parameters.pushMonthYearStationId" type="Long"/>
				
				<entity-one value-field="pushMonthYearStation" entity-name="PushMonthYearStation">
					<field-map field-name="pushMonthYearStationId" from-field="pushMonthYearStationId"/>
				</entity-one>
				<entity-one value-field="station" entity-name="Station">
					<field-map field-name="stationId" from-field="pushMonthYearStation.stationId"/>
				</entity-one>
				<set field="employerCode" from-field="station.employerCode"></set>
				
				<set field="employerName"
					value="${bsh:org.ofbiz.accountholdertransactions.RemittanceServices.getEmployerName(employerCode);}"
					type="String" />
				<set field="month" from-field="pushMonthYearStation.month" type="PlainString" />
				<set field="year" from-field="pushMonthYearStation.year" type="PlainString" />
				<set field="totalExpected" global="true"
					value="${bsh:org.ofbiz.accountholdertransactions.RemittanceServices.getTotalExpected(employerCode, month, pushMonthYearStationId);}"
					type="BigDecimal" />
				<set field="totalRemitted" global="true"
					value="${bsh:org.ofbiz.accountholdertransactions.RemittanceServices.getTotalRemitted(employerCode, month, pushMonthYearStationId);}"
					type="BigDecimal" />
				<set field="totalChequeAmount" global="true"
					value="${bsh:org.ofbiz.accountholdertransactions.RemittanceServices.getTotalRemittedChequeAmount(employerCode, month);}"
					type="BigDecimal" />

				<entity-one entity-name="ExpectedPaymentSent"
					value-field="expectedPaymentSentContext" />
					

			</actions>
			<widgets>
				<decorator-screen name="OnlineRemittanceProcessingCommonDecorator"
					location="${parameters.mainDecoratorLocation}">
					<decorator-section name="body">
						<!-- include-menu
							location="component://accountholdertransactions/widget/accountholdertransactions/AccHolderTransactionsMenus.xml"
							name="expectedPaymentsTabBar" / -->
						<!-- section> <condition> <if-has-permission permission="ACCOUNTHOLDER"
							action="_CREATE"/> </condition> <widgets> <screenlet title="Expected Payment">
							<include-form name="NewExpectedPayment" location="component://accountholdertransactions/widget/accountholdertransactions/AccHolderTransactionsForms.xml"/>
							</screenlet> </widgets> <fail-widgets> <label style="h3">${uiLabelMap.PartyMgrCreatePermissionError}</label>
							</fail-widgets> </section -->
						<section>
							<widgets>
								<screenlet>
									<section>

										<widgets>

											<container style="button-bar">
												<label style="h3">Received Remittance from ${employerName}
													for ${month}${year} </label>
												<!-- parameter param-name="loanApplicationId"/ -->
												<!-- link
													target="expectedPaymentBreakdownpdf.pdf?month=${month}&amp;employerCode=${employerCode}"
													text="Print Expected Payment Breakdown" style="buttontext">
													
													<image url-mode="raw"
														src="${iconsLocation}/page_white_acrobat.png" />
												</link>

												<link
													target="expectedPaymentBreakdowncsv.csv?month=${month}&amp;employerCode=${employerCode}"
													text="Generate Expected Payment Breakdown CSV" style="buttontext">
													<image url-mode="raw" src="${iconsLocation}/page_excel.png" />

												</link -->
												
												<link
													target="receivedRemittanceExport.csv?pushMonthYearStationId=${pushMonthYearStationId}"
													text="Expected Remittance CSV (Download)" style="buttontext">
													<image url-mode="raw" src="${iconsLocation}/page_excel.png" />

												</link>
											</container>
										</widgets>

									</section>
								</screenlet>
							</widgets>
						</section>

						<section name="Received Remittance Breakdown">
							<widgets>
								<!--screenlet title="Find Expected Payment Sent">
									<include-form name="FindExpectedPaymentSent"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet -->
								<screenlet title="Expected Payment Breakdown">
									<include-form name="listExpectedPaymentReceivedBreakdown"
										location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
								</screenlet>


																<screenlet>
									<!-- include-form name="listExpectedPaymentReceivedBreakdownTotals"
										location="component://accountholdertransactions/widget/accountholdertransactions/AccHolderTransactionsForms.xml"/ -->
									<section>
										<widgets>
											<container style="button-bar">
												<label style="h3">Total Expected : Kshs. ${totalExpected}
												</label>
												<label style="h3">Total Received (Schedule) : Kshs.
													${totalRemitted} </label>
												<label style="h3">Total Received (Cheque Amount) : Kshs.
													${totalChequeAmount} </label>


											</container>
										</widgets>
									</section>
								</screenlet>
							</widgets>
						</section>
					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>	

	<screen name="expectedRemittanceExport">
		<section>
			<actions>
				<set field="viewSize" value="99999" />
				<!-- script location="component://party/webapp/partymgr/WEB-INF/actions/reports/loanDetails.groovy"/ -->
				<script
					location="component://onlineremittanceprocessing/webapp/onlineremittanceprocessing/WEB-INF/actions/reports/expectedRemittanceSent.groovy" />
			</actions>
			<widgets>
				<include-form name="expectedRemittanceExport"
					location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
			</widgets>
		</section>
	</screen>
	
	<!-- receivedRemittanceExport -->
		<screen name="receivedRemittanceExport">
		<section>
			<actions>
				<set field="viewSize" value="99999" />
				<!-- script location="component://party/webapp/partymgr/WEB-INF/actions/reports/loanDetails.groovy"/ -->
				<script
					location="component://onlineremittanceprocessing/webapp/onlineremittanceprocessing/WEB-INF/actions/reports/expectedRemittanceReceived.groovy" />
			</actions>
			<widgets>
				<include-form name="receivedRemittanceExport"
					location="component://onlineremittanceprocessing/widget/OnlineRemittanceProcessingForms.xml" />
			</widgets>
		</section>
	</screen>
</screens>